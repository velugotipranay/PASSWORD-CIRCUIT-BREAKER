RS EQU P3.7
RW EQU P3.6
E EQU P3.5	
ORG 200H
	DB 38H,0EH,06H,01H,80H
ORG 250H
	DB " ENTER PASSWORD"
ORG 300H
	DB " LOAD IS CLOSED"
ORG 350H
	DB " WRONG PASSWORD"
ORG 400H
	DB " LOAD IS OPEN"

ORG 450H
KCODE1: DB '1','2','3' ;ROW_0
KCODE2: DB '4','5','6' ;ROW_1
KCODE3: DB '7','8','9'	;ROW_2	
KCODE4: DB '*','0','#'	;ROW_3	
ORG 00H
	MOV P2,#0FFH
	MOV P1,#00H
	CLR P3.0
	MOV TMOD,#11H
	AGAIN9:  ACALL CON 
     ACALL TEXT1 
	 ACALL LINE2

	 ;P1.0-P1.2 ARE ROWS P2.0-P2.3 ARE COLUMNS 
	 MOV R5,#4
  K1:CLR A
     MOV P0,#0H
	 MOV A,P2
	 
	 ANL A,#00001111B
	 CJNE A,#00001111B,K1
	 
  K2:CLR A
    ACALL DELAY2
     MOV A,P2
	 ANL A,#00001111B
	 CJNE A,#00001111B,OVER1
	 SJMP K2
	 
  OVER:
       ACALL DELAY2
        MOV  A,P2
		ANL A,#00001111B
	    CJNE A,#00001111B,OVER1
	    SJMP K2
  
  OVER1:MOV P0,#11111110B
        MOV A,P2
        ANL A,#00001111B
        CJNE A,#00001111B,ROW0
		
		MOV P0,#11111101B
		MOV A,P2
		ANL A,#00001111B
	    CJNE A,#00001111B,ROW1
		
		MOV P0,#11111011B
		MOV A,P2
		ANL A,#00001111B
	    CJNE A,#00001111B,ROW2
		MOV P0,#11110111B
		MOV A,P2
		ANL A,#00001111B
	    CJNE A,#00001111B,ROW3
		LJMP K2
		
   ROW0:MOV DPTR,#KCODE1
         SJMP FIND
	ROW1:MOV DPTR,#KCODE2
         SJMP FIND
   ROW2:MOV DPTR,#KCODE3
         SJMP FIND
   ROW3:MOV DPTR,#KCODE4
         SJMP FIND	 
   FIND:RRC A
		JNC MATCH
        INC DPTR
        SJMP FIND		
	    
   MATCH:CLR A
         MOVC A,@A+DPTR
		 MOV B,A
		 ACALL DISP1
		 ACALL DELAY3
		 ACALL DELAY3
		 ACALL DELAY3
		 ACALL DELAY3
		 MOV A,B
		 CJNE A,#'1',HERE3
		 CLR A
		 DJNZ R5,AGAIN4
		 ACALL HERE12
		 HERE3:CJNE A,#'2',HERE4
		 CLR A
		 DJNZ R5,AGAIN4
		 ACALL HERE12
		HERE4:CJNE A,#'3',HERE5
		CLR A
		DJNZ R5,AGAIN4
		ACALL HERE12
		HERE5:CJNE A,#'5',HERE6
		CLR A
		DJNZ R5,AGAIN4
        LJMP MAIN
		
		AGAIN4:LJMP K1
		HERE6:DJNZ R5,AGAIN4
		
		HERE12:ACALL TEXT3
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
		LJMP AGAIN9
		 
	 
	 
	 DELAY2:MOV TH0,#0B8H  ; 20ms delay
	        MOV TL0,#02H
	        SETB TR0
		L6:JNB TF0,L6
				CLR TF0
				CLR TR0
				RET
				
	DELAY3:MOV R0,#0FFH
	L9:MOV R7,#0FFH
	 L7:DJNZ R7,L7
	 DJNZ R0,L9
	 RET
		 
	 
	 
	 CON:MOV DPTR,#200H
	 MOV R1,#6
	 L1:CLR A
	 MOVC A,@A+DPTR
	 ACALL CMD
	 ACALL DELAY 
	 INC DPTR
	 DJNZ R1,L1
	 RET
	 
	 LINE2:MOV A,#0EH
	 ACALL CMD
	 MOV A,#0C0H
	 ACALL CMD
	 ACALL DELAY3
	 RET
	 
	 TEXT1: MOV DPTR ,#250H
	 MOV R2,#15
	 L2:CLR A
	 MOVC A,@A+DPTR
	 ACALL DISP
	 ACALL DELAY
	 INC DPTR
	 DJNZ R2,L2
	 RET
	 
	 TEXT2:
	 MOV A,#01H
	 ACALL CMD
	 ACALL DELAY
	 CLR A
	 MOV DPTR ,#300H
	 MOV R2,#15
	 HERE2:CLR A
	 MOVC A,@A+DPTR
	 ACALL DISP
	 ACALL DELAY
	 INC DPTR
	 DJNZ R2,HERE2
	 RET
	 
	  TEXT3:MOV A,#01H
	 ACALL CMD
	 ACALL DELAY
	  CLR A
	 MOV DPTR ,#350H
	 MOV R2,#15
	 L4:CLR A
	 MOVC A,@A+DPTR
	 ACALL DISP
	 ACALL DELAY
	 INC DPTR
	 DJNZ R2,L4
	 RET
	 
	 TEXT4:MOV A,#01H
	 ACALL CMD
	 ACALL DELAY
	  CLR A
	 MOV DPTR ,#400H
	 MOV R2,#13
	 L3:CLR A
	 MOVC A,@A+DPTR
	 ACALL DISP
	 ACALL DELAY
	 INC DPTR
	 DJNZ R2,L3
	 RET
	 
	 CMD:MOV P1,A
	 CLR RS
	 CLR RW
	 SETB E
	 ACALL DELAY
	 CLR E
	 RET
	
 DISP1:
 MOV A,#'*'
 MOV P1,A
	 SETB RS
	 CLR RW
	 SETB E
	 ACALL DELAY
	 CLR E
	 RET	
	  
	 DISP:MOV P1,A
	 SETB RS
	 CLR RW
	 SETB E
	 ACALL DELAY
	 CLR E
	 RET
	 
	 DELAY:MOV R0,#0FFH
	 L5:DJNZ R0,L5
	 RET
	MAIN:CPL P3.0
	JNB P3.0,AGAIN11
	ACALL TEXT2
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
	ACALL AGAIN9
	AGAIN11:ACALL TEXT4
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
		ACALL DELAY3
	ACALL AGAIN9
	
	 END
	 