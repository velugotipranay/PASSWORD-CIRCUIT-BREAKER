RS EQU P2.7
RW EQU P2.6
E EQU P2.5	
ORG 200H
	DB 0EH,06H,01H,80H
ORG 250H
	DB "ENTER PASSWORD"
ORG 300H
	DB "LOAD IS CLOSED"
ORG 350H
	DB "WRONG PASSWORD"
ORG 400H
	DB "1234"
ORG 450H
KCODE1: DB '3','6','9','#' ;ROW_0
KCODE2: DB '2','5','8','0' ;ROW_1
KCODE3: DB '1','4','7','*'	;ROW_2	
ORG 00H
	MOV P2,#0FFH
	MOV P0,#00H
	CLR P3.0
	MOV TMOD,#01H
     ACALL CON ;MAIN
     ACALL TEXT1
	 ACALL LINE2
	 ACALL ENTER
/*	 MOV DPTR,#400H
 AGAIN:CLR A
	 MOV R4,#4
	 MOVC A,@A+DPTR
	 MOV P
	 CJNE P0,*/
	 ;P1.0-P1.2 ARE ROWS P2.0-P2.3 ARE COLUMNS 
     ENTER:MOV R3,#4
  K1:CLR A
     MOV P1,#0
	 MOV A,P2
	 
	 ANL A,#00001111B
	 CJNE A,#00001111B,K1
	 
  K2:ACALL DELAY2
     MOV A,P2
	 ANL A,#00001111B
	 CJNE A,#00001111B,OVER
	 SJMP K2
	 
  OVER: ACALL DELAY
        MOV  A,P2
		ANL A,#00001111B
	    CJNE A,#00001111B,OVER1
	    SJMP K2
  
  OVER1:MOV P1,#11111110B
        MOV A,P2
        ANL A,#00001111B
        CJNE A,#00001111B,ROW0
		MOV P1,#11111101B
		MOV A,P2
		ANL A,#00001111B
	    CJNE A,#00001111B,ROW1
		MOV P1,#11111011B
		MOV A,P2
		ANL A,#00001111B
	    CJNE A,#00001111B,ROW2
		LJMP K2
		
   ROW0:MOV DPTR,#KCODE1
         SJMP FIND
	ROW1:MOV DPTR,#KCODE2
         SJMP FIND
   ROW2:MOV DPTR,#KCODE3
         SJMP FIND
		 
   FIND:RRC A
		JNC MATCH
        INC DPTR
        SJMP FIND		
	    
   MATCH:CLR A
         MOVC A,@A+DPTR
         MOV P1,A
		 
		 DJNZ R3,K1
         RET		 
	 
	 
	 
	 
	 DELAY2:MOV TH0,#0B8H  ; 20ms delay
	        MOV TL0,#02H
	        SETB TR0
			JNB TF0,$
				CLR TF0
				CLR TR0
				RET
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 CON:CLR A
	 MOV R2,#4
	 L1:MOVC A,@A+DPTR
	 ACALL CMD
	 ACALL DELAY 
	 INC DPTR
	 DJNZ R2,L1
	 RET
	 
	 LINE2:MOV A,#0CH
	 ACALL CMD
	 RET
	 
	 TEXT1: CLR A
	 L2:MOV DPTR ,#250H
	 MOV R2,#14
	 MOVC A,@A+DPTR
	 ACALL DISP
	 ACALL DELAY
	 INC DPTR
	 DJNZ R2,L2
	 RET
	 
	 TEXT2 :CLR A
	 L3:MOV DPTR ,#300H
	 MOV R2,#14
	 MOVC A,@A+DPTR
	 ACALL DISP
	 ACALL DELAY
	 INC DPTR
	 DJNZ R2,L3
	 RET
	 
	  TEXT3 :CLR A
	 L4:MOV DPTR ,#350H
	 MOV R2,#14
	 MOVC A,@A+DPTR
	 ACALL DISP
	 ACALL DELAY
	 INC DPTR
	 DJNZ R2,L4
	 RET
	 
	 CMD:MOV P1,A
	 CLR RS
	 CLR RW
	 SETB E
	 ACALL DELAY
	 CLR E
	 RET
	 
	 DISP:MOV P1,A
	 SETB RS
	 CLR RW
	 SETB E
	 ACALL DELAY
	 CLR E
	 RET
	 
	 DELAY:MOV R0,#0FFH
	 L6:MOV R1,#0FFH
	 L5:DJNZ R1,L5
	 DJNZ R0,L6
	 END
	
	
	 